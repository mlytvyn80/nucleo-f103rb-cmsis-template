# Nucleo F103RB & CMSIS

This repository contains a template of CMSIS project for Nucleo F103RB development board. I created this repository because I wasn't able to find anything similar with only CMSIS and a minimum amount of code needed to get the board up and running.

I'm not a fan of HAL and bloated projects generated by CubeMX. Although this tool is very convenient for initial configuration, it lacks possibility of creating non-HAL projects with only CMSIS on board. I was quite startled by the amount of code CubeMX had generated for a simple project, and then I started wondering whether is it possible to make it smaller and simpler. Fortunately the answer was affirmative. 

## Content description

#### main

A directory containing only the main code. The main code sets up  a system clock and lights up the user LED (the green one). No more, no less. A clock initialization procedure is annotated with my comments, so you will see it's not as hard as you might thought it is.

#### platform

A directory with files specific for this board. All files in this directory were taken from CubeMX. I can't assure you I included everything, it works for me, but if you get errors saying that some header wasn't found, you'll have to do the following:

1. Download and install CubeMX.
2. In CubeMX, go to the package manager, it should be in **Help** menu.
3. Download a firmware package appropriate to your MCU.
4. Find out where downloaded packages are located (Help -> Updated settings).
5. Go to this directory, locate your freshly downloaded firmware and take any files you need and want. All headers, sources, libraries and linker files are there.

> **IMPORTANT**
>
> If you want to use a linker script from the firmware package, you have to modify it a little. For unknown to me reason, linker scripts contains a single `0` symbol in empty lines. You need to get rid of them before using the script.

#### CMakeLists.txt

A project configuration for CMake build system. Adapt it to your project.

#### arm.cmake

A toolchain configuration. You have to adapt this to your system and ARM compiler location.

## Building

As you can see I use CMake to generate all necessary build files. If you don't have it installed, never were a better time to do so. 
You also need to install the ARM GCC toolchain:

```
sudo apt install gcc-arm-none-eabi
```
Install build dependencies:

```
sudo apt install cmake build-essential
```
Install OpenOCD to be able to flash the device:

```
sudo apt install openocd
```

Create a `build` directory inside of this project, and from the inside of it execute the following command:

`cmake ..`


If CMake generated all necessary files, simply run `make all` and it should compile final binary. 
Use `make program` command to program your device.
